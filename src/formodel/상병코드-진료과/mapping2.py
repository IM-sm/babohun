import pandas as pd

# 1. CSV 파일 불러오기
df = pd.read_csv("new_merged_data/외래 진료과별 상위20 주요상병_진료과통일.csv")

'''
# 2. 상병코드 앞 3자리 추출
df['코드'] = df['상명코드'].astype(str).str[:3].str.upper()


# 3. 진료과 표준화 매핑 (이미 정의된 dictionary 사용)
department_mapping = {
    'DM': '피부과',
    '가정의학과': '가정의학과',
    '감염내과': '내과',
    '감염병전담의학과': '내과',
    '구강내과': '치과',
    '구강악안면외과': '치과',
    '내분비내과': '내과',
    '류마티스내과': '내과',
    '마취통증의학과': '마취통증의학과',
    '방사선종양학과': '방사선종양학과',
    '비뇨의학과': '비뇨의학과',
    '산부인과': '산부인과',
    '생활지원센터': '건강관리과',
    '성형외과': '성형외과',
    '소아청소년과': '소아청소년과',
    '소화기내과': '내과',
    '수면다원검사과': '건강관리과',
    '순환기내과': '내과',
    '신경과': '신경과',
    '신경외과': '신경외과',
    '신장내과': '내과',
    '심장내과': '내과',
    '안과': '안과',
    '암센터': '암센터',
    '영상의학과': '영상의학과',
    '완화의료사업': '호스피스완화의료센터',
    '외과': '외과',
    '욕창성형클리닉': '외과',
    '응급의학과': '응급의학과',
    '이비인후과': '이비인후과',
    '일반검진': '건강관리과',
    '일반내과': '내과',
    '입원전담의학과': '건강관리과',
    '재택치료진료센터': '건강관리과',
    '재활의학과': '재활의학과',
    '정신건강의학과': '정신건강의학과',
    '정형외과': '정형외과',
    '제작부': '건강관리과',
    '종합검진': '건강관리과',
    '진단검사의학과': '진단검사의학과',
    '진료부장실': '건강관리과',
    '치과': '치과',
    '치과보존과': '치과',
    '치과보철과': '치과',
    '치주과': '치과',
    '통증클리닉': '마취통증의학과',
    '통합치의학과': '치과',
    '피부과': '피부과',
    '한방진료과': '한의과',
    '한의과': '한의과',
    '핵의학과': '핵의학과',
    '혈액종양내과': '내과',
    '호스피스완화의료센터': '건강관리과',
    '호흡기·알레르기내과': '내과',
    '호흡기내과': '내과',
    '흉부외과': '흉부외과'
}

df['표준_진료과'] = df['진료과'].map(department_mapping)


# 4. 상병코드별로 유니크 진료과 리스트 생성
unique_depts = (
    df
    .dropna(subset=['표준_진료과'])
    .groupby('코드')['표준_진료과']
    .apply(lambda x: sorted(x.unique()))
    .to_dict()
)

# 5. 결과 출력 또는 저장
for code, depts in unique_depts.items():
    print(f"{code}: {depts}")

# 필요시 DataFrame으로 만들어 CSV로 저장
unique_df = (
    pd.DataFrame({
        '상병코드': list(unique_depts.keys()),
        '진료과_목록': list(unique_depts.values())
    })
)
unique_df.to_csv("상병코드별_유니크_진료과목록.csv", index=False)
'''